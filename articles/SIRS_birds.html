<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="MicroWNV">
<title>SIRS bird model • MicroWNV</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.1.0/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.1.0/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.rawgit.com/afeld/bootstrap-toc/v1.0.1/dist/bootstrap-toc.min.js"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="SIRS bird model">
<meta property="og:description" content="MicroWNV">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">MicroWNV</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.1</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-2">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/Contributing.html">Contributing</a>
    <a class="dropdown-item" href="../articles/RM_mosquito.html">Ross-Macdonald mosquito model</a>
    <a class="dropdown-item" href="../articles/SIRS_birds.html">SIRS bird model</a>
  </div>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/dd-harp/MicroWNV/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">

<div class="row">
  <main id="main"><div class="page-header">
      <img src="" class="logo" alt=""><h1>SIRS bird model</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/dd-harp/MicroWNV/blob/HEAD/vignettes/SIRS_birds.Rmd" class="external-link"><code>vignettes/SIRS_birds.Rmd</code></a></small>
      <div class="d-none name"><code>SIRS_birds.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/dd-harp/MicroWNV" class="external-link">MicroWNV</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-datatable.com" class="external-link">data.table</a></span><span class="op">)</span></code></pre></div>
<p>The bird component needs to model pathogen dynamics in host bird species. We demonstrate here the use of the basic SIRS (Susceptible-Infectious-Recovered-Susceptible) model of adult bird dynamics that fulfills the required bird component interface. Using the bird component necessarily means we need to specify a model for the fledgling (immature) bird component, for which we use a simple trace-derived (forced) model.</p>
<p>The SIRS model implemented here is a simple ODE (Ordinary Differential Equation) style model adapted for a discrete time step, and comes in both deterministic and stochastic versions. To sample/compute state updates we use an Euler scheme similar to the 3rd method (Binomial increments with exponential probability) from <a href="https://kingaa.github.io/short-course/stochsim/stochsim.html#eulers-method-for-a-discrete-sir-model" class="external-link">this document</a>, which is a standard method to discretize continuous time stochastic dynamics.</p>
<p>The model requires the following parameters:</p>
<ul>
<li>
<code>fledge_disperse</code>: a dispersal matrix describing how fledglings disperse from their natal nests upon reachind adulthood</li>
<li>
<code>theta</code>: a “time spent” matrix for birds, giving how they distribute their time across a home range</li>
<li>
<code>mu</code>: daily mortality rate (may be time-varying)</li>
<li>
<code>wf</code>: vector of biting weights for each patch/place</li>
<li>
<code>gamma</code>: inverse of infectious duration (recovery rate)</li>
<li>
<code>r</code>: inverse of immune duration (rate of loss of immunity)</li>
</ul>
<p>The state of the model is stored in a <code>p</code> by <code>3</code> matrix where the columns correspond to the <code>S</code>, <code>I</code>, and <code>R</code> states. New fledglings are always added to the <code>S</code> state.</p>
<div class="section level2">
<h2 id="deterministic-model">Deterministic model<a class="anchor" aria-label="anchor" href="#deterministic-model"></a>
</h2>
<p>The deterministic model has the following form:</p>
<p><span class="math display">\[\begin{equation}
S_{t+1} = e^{-(\mu_{t} + h_{t})} S_{t} + (1 - e^{-(\mu_{t} + \gamma)}) \left( \frac{r}{\mu_{t} + r} \right) R_{t} + (\lambda_{t} \cdot \psi) \\
I_{t+1} = e^{-(\mu_{t} + \gamma)} E_{t} + (1 - e^{-(\mu_{t} + h_{t})}) \left( \frac{h_{t}}{\mu_{t} + h_{t}} \right) S_{t} \\
R_{t+1} = e^{-(\mu_{t} + r)} R_{t} + (1 - e^{-(\mu_{t} + \gamma)}) \left( \frac{\gamma}{\mu_{t} + \gamma} \right) I_{t} \\
\end{equation}\]</span></p>
<p>where <span class="math inline">\(\psi\)</span> is the dispersal matrix for new fledglings, and <span class="math inline">\(\lambda_{t}\)</span> is the number of new fledglings reaching adulthood on that day, which is calculated from the fledgling component.</p>
</div>
<div class="section level2">
<h2 id="stochastic-model">Stochastic model<a class="anchor" aria-label="anchor" href="#stochastic-model"></a>
</h2>
<p>The stochastic model is largely the same as the deterministic one, except all flows between compartments are sampled from the appropriate binomial distribution and the model’s state space is integer vectors.</p>
</div>
<div class="section level2">
<h2 id="example">Example<a class="anchor" aria-label="anchor" href="#example"></a>
</h2>
<p>We’ll run a simple example here, for 3 years. We need to specify <span class="math inline">\(\lambda\)</span>, which we’ll choose to be of length <code>365</code>, giving the number of fledgling birds reaching adulthood per day, per patch, each day of the year. It will peak in the middle of the year, at 10 birds.</p>
<p>We will use a very mild sinusoidal seasonal signal for mortality, where the average over the year is <code>mean_mu</code>. Please note these are not particularly realistic parameter values for birds, but merely intended to showcase functionality.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">tmax</span> <span class="op">&lt;-</span> <span class="fl">365</span> <span class="op">*</span> <span class="fl">3</span>
<span class="va">p</span> <span class="op">&lt;-</span> <span class="fl">3</span>

<span class="va">gamma</span> <span class="op">&lt;-</span> <span class="fl">1</span><span class="op">/</span><span class="fl">7</span>
<span class="va">r</span> <span class="op">&lt;-</span> <span class="fl">1</span><span class="op">/</span><span class="fl">60</span>

<span class="va">lambda</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">dnorm</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">365</span>, mean <span class="op">=</span> <span class="fl">180</span>, sd <span class="op">=</span> <span class="fl">90</span><span class="op">)</span>
<span class="va">lambda</span> <span class="op">&lt;-</span> <span class="va">lambda</span> <span class="op">*</span> <span class="op">(</span><span class="fl">5</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">lambda</span><span class="op">)</span><span class="op">)</span>
<span class="va">lambda</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">replicate</a></span><span class="op">(</span><span class="va">p</span>, <span class="va">lambda</span><span class="op">)</span><span class="op">)</span>

<span class="va">seasonal_signal</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Trig.html" class="external-link">sin</a></span><span class="op">(</span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">365</span><span class="op">)</span><span class="op">/</span><span class="fl">365</span><span class="op">*</span><span class="fl">2</span><span class="op">*</span><span class="va">pi</span> <span class="op">+</span> <span class="fl">90</span><span class="op">)</span> <span class="op">+</span> <span class="fl">1</span>
<span class="va">mean_mu</span> <span class="op">&lt;-</span> <span class="fl">1</span><span class="op">/</span><span class="fl">365</span>

<span class="va">mu</span> <span class="op">&lt;-</span> <span class="va">seasonal_signal</span> <span class="op">*</span> <span class="va">mean_mu</span>
<span class="va">mu</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">pmax</a></span><span class="op">(</span><span class="va">mu</span>, <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="va">.Machine</span><span class="op">$</span><span class="va">double.eps</span><span class="op">)</span><span class="op">)</span> <span class="co"># just to avoid numerical issues</span>

<span class="va">fledge_disperse</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span>
  <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>
    <span class="fl">0.9</span>, <span class="fl">0.05</span>, <span class="fl">0.05</span>,
    <span class="fl">0.05</span>, <span class="fl">0.9</span>, <span class="fl">0.05</span>,
    <span class="fl">0.05</span>, <span class="fl">0.05</span>, <span class="fl">0.9</span>
  <span class="op">)</span>, nrow <span class="op">=</span> <span class="fl">3</span>, ncol <span class="op">=</span> <span class="fl">3</span>, 
  byrow <span class="op">=</span> <span class="cn">TRUE</span>
<span class="op">)</span>

<span class="va">theta</span> <span class="op">&lt;-</span> <span class="va">fledge_disperse</span>

<span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">5</span>,<span class="fl">5</span>,<span class="fl">2</span>,<span class="fl">5</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">lambda</span><span class="op">[</span><span class="fl">1</span>, <span class="op">]</span>, type <span class="op">=</span> <span class="st">"l"</span>, col <span class="op">=</span> <span class="st">"red"</span>, xlab <span class="op">=</span> <span class="st">"Day"</span>, ylab <span class="op">=</span> <span class="st">"Fledgling births (red)"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>new <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">mu</span>, type <span class="op">=</span> <span class="st">"l"</span>, axes <span class="op">=</span> <span class="cn">F</span>, xlab <span class="op">=</span> <span class="cn">NA</span>, ylab <span class="op">=</span> <span class="cn">NA</span>, col <span class="op">=</span> <span class="st">"blue"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/axis.html" class="external-link">axis</a></span><span class="op">(</span>side <span class="op">=</span> <span class="fl">4</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/mtext.html" class="external-link">mtext</a></span><span class="op">(</span>side <span class="op">=</span> <span class="fl">4</span>, line <span class="op">=</span> <span class="fl">3</span>, <span class="st">'Mortality rate (blue)'</span><span class="op">)</span></code></pre></div>
<p><img src="SIRS_birds_files/figure-html/unnamed-chunk-2-1.png" width="768"></p>
<div class="section level3">
<h3 id="deterministic-simulation">Deterministic simulation<a class="anchor" aria-label="anchor" href="#deterministic-simulation"></a>
</h3>
<p>We set the daily force of infection such that on average <span class="math inline">\(5\%\)</span> of birds would become infected each day. Let’s first do a deterministic simulation. We use <code>setup_birds_SIRS</code> to setup the SIRS birds model for the bird component, and <code>setup_fledge_trace</code> to set up the fledgling (immature) component as a simple trace (forced) model.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">SIR</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span>data <span class="op">=</span> <span class="fl">0</span>, nrow <span class="op">=</span> <span class="va">p</span>, ncol <span class="op">=</span> <span class="fl">3</span><span class="op">)</span>
<span class="va">SIR</span><span class="op">[</span>, <span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">10</span>

<span class="va">mod</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/make_microWNV.html">make_microWNV</a></span><span class="op">(</span>tmax <span class="op">=</span> <span class="va">tmax</span>, p <span class="op">=</span> <span class="fl">3</span><span class="op">)</span>
<span class="fu"><a href="../reference/setup_birds_SIRS.html">setup_birds_SIRS</a></span><span class="op">(</span><span class="va">mod</span>, stochastic <span class="op">=</span> <span class="cn">FALSE</span>, fledge_disperse <span class="op">=</span> <span class="va">fledge_disperse</span>, theta <span class="op">=</span> <span class="va">theta</span>, SIR <span class="op">=</span> <span class="va">SIR</span>, mu <span class="op">=</span> <span class="va">mu</span>, gamma <span class="op">=</span> <span class="va">gamma</span>, r <span class="op">=</span> <span class="va">r</span><span class="op">)</span>
<span class="fu"><a href="../reference/setup_fledge_trace.html">setup_fledge_trace</a></span><span class="op">(</span><span class="va">mod</span>, trace <span class="op">=</span> <span class="va">lambda</span>, stochastic <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>

<span class="va">SIR_det</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span>data <span class="op">=</span> <span class="cn">NaN</span>, nrow <span class="op">=</span> <span class="va">tmax</span> <span class="op">*</span> <span class="fl">3</span>, ncol <span class="op">=</span> <span class="fl">4</span>, dimnames <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="cn">NULL</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Patch"</span>, <span class="st">"S"</span>, <span class="st">"I"</span>, <span class="st">"R"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
<span class="va">SIR_det</span><span class="op">[</span>, <span class="st">"Patch"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span>, times <span class="op">=</span> <span class="va">tmax</span><span class="op">)</span>

<span class="co"># run it</span>
<span class="kw">while</span><span class="op">(</span><span class="va">mod</span><span class="op">$</span><span class="va">global</span><span class="op">$</span><span class="va">tnow</span> <span class="op">&lt;=</span> <span class="va">tmax</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">mod</span><span class="op">$</span><span class="va">bird</span><span class="op">$</span><span class="va">h</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Exponential.html" class="external-link">qexp</a></span><span class="op">(</span>p <span class="op">=</span> <span class="fl">0.05</span><span class="op">)</span>
  <span class="fu"><a href="../reference/step_fledge.html">step_fledge</a></span><span class="op">(</span>model <span class="op">=</span> <span class="va">mod</span><span class="op">)</span>
  <span class="fu"><a href="../reference/step_birds.html">step_birds</a></span><span class="op">(</span>model <span class="op">=</span> <span class="va">mod</span><span class="op">)</span>
  <span class="va">ix_fill</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/is.finite.html" class="external-link">is.nan</a></span><span class="op">(</span><span class="va">SIR_det</span><span class="op">[</span>, <span class="fl">2</span><span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">]</span>
  <span class="va">SIR_det</span><span class="op">[</span><span class="va">ix_fill</span>, <span class="fl">2</span><span class="op">:</span><span class="fl">4</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">mod</span><span class="op">$</span><span class="va">bird</span><span class="op">$</span><span class="va">SIR</span>
  <span class="va">mod</span><span class="op">$</span><span class="va">global</span><span class="op">$</span><span class="va">tnow</span> <span class="op">&lt;-</span> <span class="va">mod</span><span class="op">$</span><span class="va">global</span><span class="op">$</span><span class="va">tnow</span> <span class="op">+</span> <span class="fl">1L</span>
<span class="op">}</span>

<span class="va">det_out</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/as.data.table.html" class="external-link">as.data.table</a></span><span class="op">(</span><span class="va">SIR_det</span><span class="op">)</span>
<span class="va">det_out</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/melt.data.table.html" class="external-link">melt</a></span><span class="op">(</span><span class="va">det_out</span>, id.vars <span class="op">=</span> <span class="st">"Patch"</span>, variable.name <span class="op">=</span> <span class="st">"Compartment"</span>, value.name <span class="op">=</span> <span class="st">"Count"</span><span class="op">)</span>
<span class="va">det_out</span><span class="op">[</span>, <span class="st">"Day"</span> <span class="op">:=</span> <span class="fl">1</span><span class="op">:</span><span class="va">.N</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Patch"</span>, <span class="st">"Compartment"</span><span class="op">)</span><span class="op">]</span>

<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">det_out</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">Day</span>, y <span class="op">=</span> <span class="va">Count</span>, color <span class="op">=</span> <span class="va">Compartment</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_grid.html" class="external-link">facet_grid</a></span><span class="op">(</span><span class="va">Patch</span> <span class="op">~</span> <span class="va">.</span><span class="op">)</span></code></pre></div>
<p><img src="SIRS_birds_files/figure-html/unnamed-chunk-3-1.png" width="960"></p>
</div>
<div class="section level3">
<h3 id="stochastic-simulation">Stochastic simulation<a class="anchor" aria-label="anchor" href="#stochastic-simulation"></a>
</h3>
<p>Now we run 10 stochastic simulations, using the same parameters.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">sto_out</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span>X <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">10</span>, FUN <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">runid</span><span class="op">)</span> <span class="op">{</span>
  
  <span class="va">mod</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/make_microWNV.html">make_microWNV</a></span><span class="op">(</span>tmax <span class="op">=</span> <span class="va">tmax</span>, p <span class="op">=</span> <span class="fl">3</span><span class="op">)</span>
  <span class="fu"><a href="../reference/setup_birds_SIRS.html">setup_birds_SIRS</a></span><span class="op">(</span><span class="va">mod</span>, stochastic <span class="op">=</span> <span class="cn">TRUE</span>, fledge_disperse <span class="op">=</span> <span class="va">fledge_disperse</span>, theta <span class="op">=</span> <span class="va">theta</span>, SIR <span class="op">=</span> <span class="va">SIR</span>, mu <span class="op">=</span> <span class="va">mu</span>, gamma <span class="op">=</span> <span class="va">gamma</span>, r <span class="op">=</span> <span class="va">r</span><span class="op">)</span>
  <span class="fu"><a href="../reference/setup_fledge_trace.html">setup_fledge_trace</a></span><span class="op">(</span><span class="va">mod</span>, trace <span class="op">=</span> <span class="va">lambda</span>, stochastic <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
  
  <span class="va">SIR_out</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span>data <span class="op">=</span> <span class="cn">NaN</span>, nrow <span class="op">=</span> <span class="va">tmax</span> <span class="op">*</span> <span class="fl">3</span>, ncol <span class="op">=</span> <span class="fl">4</span>, dimnames <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="cn">NULL</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Patch"</span>, <span class="st">"S"</span>, <span class="st">"I"</span>, <span class="st">"R"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
  <span class="va">SIR_out</span><span class="op">[</span>, <span class="st">"Patch"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span>, times <span class="op">=</span> <span class="va">tmax</span><span class="op">)</span>
  
  <span class="co"># run it</span>
  <span class="kw">while</span><span class="op">(</span><span class="va">mod</span><span class="op">$</span><span class="va">global</span><span class="op">$</span><span class="va">tnow</span> <span class="op">&lt;=</span> <span class="va">tmax</span><span class="op">)</span> <span class="op">{</span>
    <span class="va">mod</span><span class="op">$</span><span class="va">bird</span><span class="op">$</span><span class="va">h</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Exponential.html" class="external-link">qexp</a></span><span class="op">(</span>p <span class="op">=</span> <span class="fl">0.05</span><span class="op">)</span>
    <span class="fu"><a href="../reference/step_fledge.html">step_fledge</a></span><span class="op">(</span>model <span class="op">=</span> <span class="va">mod</span><span class="op">)</span>
    <span class="fu"><a href="../reference/step_birds.html">step_birds</a></span><span class="op">(</span>model <span class="op">=</span> <span class="va">mod</span><span class="op">)</span>
    <span class="va">ix_fill</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/is.finite.html" class="external-link">is.nan</a></span><span class="op">(</span><span class="va">SIR_out</span><span class="op">[</span>, <span class="fl">2</span><span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">]</span>
    <span class="va">SIR_out</span><span class="op">[</span><span class="va">ix_fill</span>, <span class="fl">2</span><span class="op">:</span><span class="fl">4</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">mod</span><span class="op">$</span><span class="va">bird</span><span class="op">$</span><span class="va">SIR</span>
    <span class="va">mod</span><span class="op">$</span><span class="va">global</span><span class="op">$</span><span class="va">tnow</span> <span class="op">&lt;-</span> <span class="va">mod</span><span class="op">$</span><span class="va">global</span><span class="op">$</span><span class="va">tnow</span> <span class="op">+</span> <span class="fl">1L</span>
  <span class="op">}</span>
  
  <span class="va">out</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/as.data.table.html" class="external-link">as.data.table</a></span><span class="op">(</span><span class="va">SIR_out</span><span class="op">)</span>
  <span class="va">out</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/melt.data.table.html" class="external-link">melt</a></span><span class="op">(</span><span class="va">out</span>, id.vars <span class="op">=</span> <span class="st">"Patch"</span>, variable.name <span class="op">=</span> <span class="st">"Compartment"</span>, value.name <span class="op">=</span> <span class="st">"Count"</span><span class="op">)</span>
  <span class="va">out</span><span class="op">[</span>, <span class="st">"Day"</span> <span class="op">:=</span> <span class="fl">1</span><span class="op">:</span><span class="va">.N</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Patch"</span>, <span class="st">"Compartment"</span><span class="op">)</span><span class="op">]</span>
  <span class="va">out</span><span class="op">[</span>, <span class="st">"Run"</span> <span class="op">:=</span> <span class="fu"><a href="https://rdrr.io/r/base/integer.html" class="external-link">as.integer</a></span><span class="op">(</span><span class="va">runid</span><span class="op">)</span><span class="op">]</span>
    
  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">out</span><span class="op">)</span>
<span class="op">}</span><span class="op">)</span>

<span class="va">sto_out</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/do.call.html" class="external-link">do.call</a></span><span class="op">(</span><span class="va">rbind</span>, <span class="va">sto_out</span><span class="op">)</span>

<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">sto_out</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">Day</span>, y <span class="op">=</span> <span class="va">Count</span>, color <span class="op">=</span> <span class="va">Compartment</span>, group <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/interaction.html" class="external-link">interaction</a></span><span class="op">(</span><span class="va">Run</span>, <span class="va">Compartment</span><span class="op">)</span><span class="op">)</span>, alpha <span class="op">=</span> <span class="fl">0.35</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_grid.html" class="external-link">facet_grid</a></span><span class="op">(</span><span class="va">Patch</span> <span class="op">~</span> <span class="va">.</span><span class="op">)</span></code></pre></div>
<p><img src="SIRS_birds_files/figure-html/unnamed-chunk-4-1.png" width="960"></p>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Sean L. Wu, David L. Smith.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.1.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
